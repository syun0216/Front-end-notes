<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Event Loop详解 | 前端学习文档</title>
    <meta name="description" content="">
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
    
    <link rel="preload" href="/Front-end-notes/assets/css/0.styles.8eb3e75f.css" as="style"><link rel="preload" href="/Front-end-notes/assets/js/app.36d15ab6.js" as="script"><link rel="preload" href="/Front-end-notes/assets/js/2.4bda1855.js" as="script"><link rel="preload" href="/Front-end-notes/assets/js/33.91f4989b.js" as="script"><link rel="prefetch" href="/Front-end-notes/assets/js/10.ac673c75.js"><link rel="prefetch" href="/Front-end-notes/assets/js/100.a14bea01.js"><link rel="prefetch" href="/Front-end-notes/assets/js/101.be3b9803.js"><link rel="prefetch" href="/Front-end-notes/assets/js/102.16a2af5d.js"><link rel="prefetch" href="/Front-end-notes/assets/js/103.5b6a44f0.js"><link rel="prefetch" href="/Front-end-notes/assets/js/104.60397773.js"><link rel="prefetch" href="/Front-end-notes/assets/js/105.6f10dbd7.js"><link rel="prefetch" href="/Front-end-notes/assets/js/11.44b74482.js"><link rel="prefetch" href="/Front-end-notes/assets/js/12.ea96fe90.js"><link rel="prefetch" href="/Front-end-notes/assets/js/13.327b7a58.js"><link rel="prefetch" href="/Front-end-notes/assets/js/14.3a1cd2d4.js"><link rel="prefetch" href="/Front-end-notes/assets/js/15.f1c22401.js"><link rel="prefetch" href="/Front-end-notes/assets/js/16.d66a48a9.js"><link rel="prefetch" href="/Front-end-notes/assets/js/17.b4cff346.js"><link rel="prefetch" href="/Front-end-notes/assets/js/18.5f63dbd5.js"><link rel="prefetch" href="/Front-end-notes/assets/js/19.6b518568.js"><link rel="prefetch" href="/Front-end-notes/assets/js/20.aeaed237.js"><link rel="prefetch" href="/Front-end-notes/assets/js/21.6c705498.js"><link rel="prefetch" href="/Front-end-notes/assets/js/22.08c4dfa3.js"><link rel="prefetch" href="/Front-end-notes/assets/js/23.2f21ce2e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/24.5a0f1f5b.js"><link rel="prefetch" href="/Front-end-notes/assets/js/25.1f65fee5.js"><link rel="prefetch" href="/Front-end-notes/assets/js/26.42ba45b3.js"><link rel="prefetch" href="/Front-end-notes/assets/js/27.6e877d1b.js"><link rel="prefetch" href="/Front-end-notes/assets/js/28.63af92a8.js"><link rel="prefetch" href="/Front-end-notes/assets/js/29.02783203.js"><link rel="prefetch" href="/Front-end-notes/assets/js/3.266e7fe1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/30.994fa006.js"><link rel="prefetch" href="/Front-end-notes/assets/js/31.16b493b9.js"><link rel="prefetch" href="/Front-end-notes/assets/js/32.19a4895d.js"><link rel="prefetch" href="/Front-end-notes/assets/js/34.e467f021.js"><link rel="prefetch" href="/Front-end-notes/assets/js/35.8c2bce21.js"><link rel="prefetch" href="/Front-end-notes/assets/js/36.b813e6bc.js"><link rel="prefetch" href="/Front-end-notes/assets/js/37.41f76a64.js"><link rel="prefetch" href="/Front-end-notes/assets/js/38.d53a7186.js"><link rel="prefetch" href="/Front-end-notes/assets/js/39.55e0a03e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/4.910959bf.js"><link rel="prefetch" href="/Front-end-notes/assets/js/40.a4da615a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/41.645f88d0.js"><link rel="prefetch" href="/Front-end-notes/assets/js/42.9dbab224.js"><link rel="prefetch" href="/Front-end-notes/assets/js/43.f98e286f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/44.9c728970.js"><link rel="prefetch" href="/Front-end-notes/assets/js/45.42669df8.js"><link rel="prefetch" href="/Front-end-notes/assets/js/46.2ef810b9.js"><link rel="prefetch" href="/Front-end-notes/assets/js/47.389295ea.js"><link rel="prefetch" href="/Front-end-notes/assets/js/48.0e7138cf.js"><link rel="prefetch" href="/Front-end-notes/assets/js/49.22cdca41.js"><link rel="prefetch" href="/Front-end-notes/assets/js/5.35117442.js"><link rel="prefetch" href="/Front-end-notes/assets/js/50.3f473e93.js"><link rel="prefetch" href="/Front-end-notes/assets/js/51.d8458c33.js"><link rel="prefetch" href="/Front-end-notes/assets/js/52.062ff94e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/53.ace93e5e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/54.9fc80a2f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/55.a209bbda.js"><link rel="prefetch" href="/Front-end-notes/assets/js/56.65408824.js"><link rel="prefetch" href="/Front-end-notes/assets/js/57.df980d91.js"><link rel="prefetch" href="/Front-end-notes/assets/js/58.0a226310.js"><link rel="prefetch" href="/Front-end-notes/assets/js/59.9b5a4ff2.js"><link rel="prefetch" href="/Front-end-notes/assets/js/6.16e3440e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/60.c9d6bef6.js"><link rel="prefetch" href="/Front-end-notes/assets/js/61.b6e7f4cb.js"><link rel="prefetch" href="/Front-end-notes/assets/js/62.c4760f69.js"><link rel="prefetch" href="/Front-end-notes/assets/js/63.6f61e25c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/64.568f4fbf.js"><link rel="prefetch" href="/Front-end-notes/assets/js/65.92bc89b0.js"><link rel="prefetch" href="/Front-end-notes/assets/js/66.698e90c8.js"><link rel="prefetch" href="/Front-end-notes/assets/js/67.b0c13def.js"><link rel="prefetch" href="/Front-end-notes/assets/js/68.f7283172.js"><link rel="prefetch" href="/Front-end-notes/assets/js/69.5be8ca8a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/7.ad382d80.js"><link rel="prefetch" href="/Front-end-notes/assets/js/70.12a6d835.js"><link rel="prefetch" href="/Front-end-notes/assets/js/71.6ceb2a8c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/72.c6bf3372.js"><link rel="prefetch" href="/Front-end-notes/assets/js/73.8c3e7ef3.js"><link rel="prefetch" href="/Front-end-notes/assets/js/74.9f46bed7.js"><link rel="prefetch" href="/Front-end-notes/assets/js/75.7df609d7.js"><link rel="prefetch" href="/Front-end-notes/assets/js/76.f1fb7676.js"><link rel="prefetch" href="/Front-end-notes/assets/js/77.1b393d69.js"><link rel="prefetch" href="/Front-end-notes/assets/js/78.1c5c8683.js"><link rel="prefetch" href="/Front-end-notes/assets/js/79.d7836499.js"><link rel="prefetch" href="/Front-end-notes/assets/js/8.92b2a463.js"><link rel="prefetch" href="/Front-end-notes/assets/js/80.f62d2eef.js"><link rel="prefetch" href="/Front-end-notes/assets/js/81.4c51a09c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/82.c2287044.js"><link rel="prefetch" href="/Front-end-notes/assets/js/83.be291283.js"><link rel="prefetch" href="/Front-end-notes/assets/js/84.f0239975.js"><link rel="prefetch" href="/Front-end-notes/assets/js/85.37f92329.js"><link rel="prefetch" href="/Front-end-notes/assets/js/86.188b71b1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/87.9fadcc63.js"><link rel="prefetch" href="/Front-end-notes/assets/js/88.08543b96.js"><link rel="prefetch" href="/Front-end-notes/assets/js/89.4af301f8.js"><link rel="prefetch" href="/Front-end-notes/assets/js/9.d0e403d1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/90.0adaaf16.js"><link rel="prefetch" href="/Front-end-notes/assets/js/91.03f1ca80.js"><link rel="prefetch" href="/Front-end-notes/assets/js/92.93ddaa08.js"><link rel="prefetch" href="/Front-end-notes/assets/js/93.81e794fa.js"><link rel="prefetch" href="/Front-end-notes/assets/js/94.e9acd61a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/95.f7933309.js"><link rel="prefetch" href="/Front-end-notes/assets/js/96.538ae805.js"><link rel="prefetch" href="/Front-end-notes/assets/js/97.c9c95a0c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/98.c6dba3d4.js"><link rel="prefetch" href="/Front-end-notes/assets/js/99.2047d52a.js">
    <link rel="stylesheet" href="/Front-end-notes/assets/css/0.styles.8eb3e75f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Front-end-notes/" class="home-link router-link-active"><!----> <span class="site-name">前端学习文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Front-end-notes/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/Front-end-notes/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/Front-end-notes/html/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/Front-end-notes/web/" class="nav-link">网络</a></div><div class="nav-item"><a href="/Front-end-notes/project/" class="nav-link">项目构建</a></div><div class="nav-item"><a href="/Front-end-notes/algorithm/" class="nav-link">算法集合</a></div><div class="nav-item"><a href="/Front-end-notes/framework/" class="nav-link">框架</a></div><div class="nav-item"><a href="/Front-end-notes/interview/" class="nav-link">面试题</a></div><div class="nav-item"><a href="/Front-end-notes/books/" class="nav-link">读书笔记</a></div> <a href="https://github.com/syun0216/Front-end-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Front-end-notes/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/Front-end-notes/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/Front-end-notes/html/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/Front-end-notes/web/" class="nav-link">网络</a></div><div class="nav-item"><a href="/Front-end-notes/project/" class="nav-link">项目构建</a></div><div class="nav-item"><a href="/Front-end-notes/algorithm/" class="nav-link">算法集合</a></div><div class="nav-item"><a href="/Front-end-notes/framework/" class="nav-link">框架</a></div><div class="nav-item"><a href="/Front-end-notes/interview/" class="nav-link">面试题</a></div><div class="nav-item"><a href="/Front-end-notes/books/" class="nav-link">读书笔记</a></div> <a href="https://github.com/syun0216/Front-end-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ES6</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-notes/JavaScript/ES6/ES6 Decorator.html" class="sidebar-link">ES6 Decorator</a></li><li><a href="/Front-end-notes/JavaScript/ES6/ES6核心特性.html" class="sidebar-link">ES6核心特性</a></li><li><a href="/Front-end-notes/JavaScript/ES6/Promise&amp;Generator.html" class="sidebar-link">Promise&amp;Generator</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>js原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-notes/JavaScript/js原理/简单实现bind、apply和call.html" class="sidebar-link">简单实现bind、apply和call</a></li><li><a href="/Front-end-notes/JavaScript/js原理/如何遍历一个dom tree.html" class="sidebar-link">如何遍历一个dom tree</a></li><li><a href="/Front-end-notes/JavaScript/js原理/实现函数currying.html" class="sidebar-link">实现函数currying</a></li><li><a href="/Front-end-notes/JavaScript/js原理/实现一个event.html" class="sidebar-link">实现一个event</a></li><li><a href="/Front-end-notes/JavaScript/js原理/详解js的继承.html" class="sidebar-link">详解js的继承</a></li><li><a href="/Front-end-notes/JavaScript/js原理/详解requestAnimationFrame.html" class="sidebar-link">详解requestAnimationFrame</a></li><li><a href="/Front-end-notes/JavaScript/js原理/Canvas api详解.html" class="sidebar-link">Canvas api详解</a></li><li><a href="/Front-end-notes/JavaScript/js原理/DOM事件.html" class="sidebar-link">DOM事件</a></li><li><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html" class="active sidebar-link">EventLoop详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#event-loop详解" class="sidebar-link">Event Loop详解</a></li><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#栈、队列的基本概念" class="sidebar-link">栈、队列的基本概念</a></li><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#栈（stack）" class="sidebar-link">栈（stack）</a></li><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#队列（queue）" class="sidebar-link">队列（Queue）</a></li><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#event-loop" class="sidebar-link">Event Loop</a></li><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#例子" class="sidebar-link">例子</a></li><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#例子2" class="sidebar-link">例子2</a></li><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#nodejs的event-loop" class="sidebar-link">NodeJS的Event Loop</a></li><li class="sidebar-sub-header"><a href="/Front-end-notes/JavaScript/js原理/EventLoop详解.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/Front-end-notes/JavaScript/js原理/JavaScript的内存管理.html" class="sidebar-link">JavaScript的内存管理</a></li><li><a href="/Front-end-notes/JavaScript/js原理/JavaScript的运行机制.html" class="sidebar-link">JavaScript的运行机制</a></li><li><a href="/Front-end-notes/JavaScript/js原理/Math对象.html" class="sidebar-link">Math对象</a></li><li><a href="/Front-end-notes/JavaScript/js原理/new操作符都做了什么.html" class="sidebar-link">new操作符都做了什么</a></li><li><a href="/Front-end-notes/JavaScript/js原理/Object.create基本实现原理.html" class="sidebar-link">Object.create基本实现原理</a></li><li><a href="/Front-end-notes/JavaScript/js原理/Set、Map、WeakSet和WeakMap.html" class="sidebar-link">Set、Map、WeakSet和WeakMap</a></li><li><a href="/Front-end-notes/JavaScript/js原理/web worker原理.html" class="sidebar-link">web worker原理</a></li><li><a href="/Front-end-notes/JavaScript/js原理/WebGL教程(MDN).html" class="sidebar-link">WebGL教程(MDN)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>jsInfoSeries</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-notes/JavaScript/jsInfoSeries/简介.html" class="sidebar-link">简介</a></li><li><a href="/Front-end-notes/JavaScript/jsInfoSeries/JavaScript基础知识.html" class="sidebar-link">JavaScript基础知识</a></li><li><a href="/Front-end-notes/JavaScript/jsInfoSeries/基础知识2.html" class="sidebar-link">基础知识2</a></li><li><a href="/Front-end-notes/JavaScript/jsInfoSeries/基础知识3.html" class="sidebar-link">基础知识3</a></li><li><a href="/Front-end-notes/JavaScript/jsInfoSeries/基础知识4.html" class="sidebar-link">基础知识4</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-notes/JavaScript/技巧/5个js解构有趣用途.html" class="sidebar-link">5个js解构有趣用途</a></li><li><a href="/Front-end-notes/JavaScript/技巧/如何使用set提高代码性能.html" class="sidebar-link">如何使用set提高代码性能</a></li><li><a href="/Front-end-notes/JavaScript/技巧/cordova构建项目时的问题.html" class="sidebar-link">cordova构建项目时的问题</a></li><li><a href="/Front-end-notes/JavaScript/技巧/js中轻松遍历对象属性的几种方式.html" class="sidebar-link">js中轻松遍历对象属性的几种方式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="event-loop详解"><a href="#event-loop详解" class="header-anchor">#</a> Event Loop详解</h2> <p>Event loop 即时间循环，是指浏览器或Node的解决JavaScript单线程运行时不会阻塞的一直机制，也就是我们经常使用异步的原理。</p> <h2 id="栈、队列的基本概念"><a href="#栈、队列的基本概念" class="header-anchor">#</a> 栈、队列的基本概念</h2> <p><img src="https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995437042-9d683636-9bf5-45fb-8cf3-e482b94a707d.webp#align=left&amp;display=inline&amp;height=271&amp;originHeight=271&amp;originWidth=294&amp;size=0&amp;status=done&amp;width=294" alt=""></p> <h2 id="栈（stack）"><a href="#栈（stack）" class="header-anchor">#</a> 栈（stack）</h2> <p>栈在计算机科学中是限定仅在<strong>表尾</strong>进行插入或者删除操作的线性表。<strong>栈</strong>是一种数据结构，按照后进先出的原则存储数据，先进入的数据被压在栈底，需要读数据的时候从栈顶开始弹出数据。栈是只能某一端插入和删除的特殊线性表。</p> <p><img src="https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436902-6dcf8420-be5b-4dd9-9fb6-43e567e53c86.webp#align=left&amp;display=inline&amp;height=282&amp;originHeight=282&amp;originWidth=616&amp;size=0&amp;status=done&amp;width=616" alt=""></p> <h2 id="队列（queue）"><a href="#队列（queue）" class="header-anchor">#</a> 队列（Queue）</h2> <p>只允许在表的前端进行删除，而在表的后端进行插入操作，和栈一样，队列是一种操作受限制的线性表。</p> <ul><li>队尾：进行插入操作</li> <li>队头：进行删除操作</li> <li>空队列：队列中没有数据</li> <li>队列元素：队列中的数据元素</li></ul> <p>遵循规则为先进先出（FIFO - first in first out）</p> <p><img src="https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436932-57cb6ee5-763a-47b2-a0be-4174c4fd1c66.webp#align=left&amp;display=inline&amp;height=270&amp;originHeight=270&amp;originWidth=554&amp;size=0&amp;status=done&amp;width=554" alt=""></p> <h2 id="event-loop"><a href="#event-loop" class="header-anchor">#</a> Event Loop</h2> <p>在js中，任务分两种，一种叫宏任务(MacroTask、Task)、一种叫微任务(MicroTack);</p> <h3 id="macrotask"><a href="#macrotask" class="header-anchor">#</a> MacroTask</h3> <p>script内全部代码、setTimeout、setInterval、setImmediate(ie 10)、I/O、UI Rendering.</p> <h3 id="microtask"><a href="#microtask" class="header-anchor">#</a> MicroTask</h3> <p>Process.nextTick(Node)、Promise、Object.observe(废弃)、MutationObserver</p> <h3 id="浏览器中的event-loop"><a href="#浏览器中的event-loop" class="header-anchor">#</a> 浏览器中的Event Loop</h3> <p>js有一个main thread主线程和callstack执行栈，所有任务都会被放到执行栈中等待主线程执行。</p> <h3 id="js调用栈"><a href="#js调用栈" class="header-anchor">#</a> js调用栈</h3> <p>hs调用栈采用的是后进先出的规则，当函数执行的时候，会被添加到栈的顶部，当执行栈执行完后，就会从栈顶移出，知道栈内被清空。</p> <h3 id="同步任务和异步任务"><a href="#同步任务和异步任务" class="header-anchor">#</a> 同步任务和异步任务</h3> <p>js单线程任务被氛围同步任务和异步任务，同步任务会在调用栈中按照顺序等待主线程一次执行，异步任务会在异步任务有了结果后，将注册的回调函数放到任务队列中等待主线程空闲的时候（调用栈被清空），被读取到栈内等待主线程的执行。</p> <p><img src="https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436925-9ac8fb38-4dfd-4d12-b5fe-c564ede43f80.webp#align=left&amp;display=inline&amp;height=518&amp;originHeight=518&amp;originWidth=636&amp;size=0&amp;status=done&amp;width=636" alt=""></p> <p>任务队列Task Queue是一种先进先出的数据结构</p> <p><img src="https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995437021-43545b5b-0a48-475a-a8a6-cce80433fe1a.webp#align=left&amp;display=inline&amp;height=669&amp;originHeight=669&amp;originWidth=800&amp;size=0&amp;status=done&amp;width=800" alt=""></p> <h3 id="时间循环的进程模型"><a href="#时间循环的进程模型" class="header-anchor">#</a> 时间循环的进程模型</h3> <ul><li>选择任务队列中最先进入的任务，当任务队列为空，则执行微任务</li> <li>时间循环中的任务设置为已选择任务</li> <li>执行任务</li> <li>将事件循环中的当前运行任务设置为null</li> <li>将已经完成的任务从任务队列中删除</li> <li>microtasks步骤：进入microtask检查点</li> <li>更新界面渲染</li> <li>返回第一步</li></ul> <h3 id="执行microtasks时有以下步骤："><a href="#执行microtasks时有以下步骤：" class="header-anchor">#</a> 执行microtasks时有以下步骤：</h3> <ul><li>设置microtask检查点标志为true</li> <li>当时间循环microtask执行不为空时，选择一个最先进入的microtask队列的microtask，将时间循环的microtask设置为已选择的microtask，运行microtask，将已经执行完成的microtask设为null，移出microtask中的microtask</li> <li>清理indexDB事务</li> <li>是指检查点为true</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2019/gif/128853/1560995436931-71f56a41-54d3-49f3-a382-c1e6acbf301e.gif#align=left&amp;display=inline&amp;height=589&amp;originHeight=589&amp;originWidth=1011&amp;size=0&amp;status=done&amp;width=1011" alt=""></p> <p>执行栈在执行完<strong>同步任务</strong>后，查看执行栈是否为空，如果执行栈为空，就会去检查<strong>微任务</strong>(microTask)队列是否为空，如果为空的话，就执行Task（宏任务），否则就一次性执行完所有微任务。
每次单个宏任务执行完毕后，检查<strong>微任务</strong>(microTask)队列是否为空，如果不为空的话，会按照<strong>先入先出</strong>的规则全部执行完微任务(microTask)后，设置微任务(microTask)队列为null，然后再执行<strong>宏任务</strong>，如此循环。</p> <h2 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h2> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://link.juejin.im/?target=https%3A%2F%2Fjakearchibald.com%2F2015%2Ftasks-microtasks-queues-and-schedules%2F" target="_blank" rel="noopener noreferrer">Tasks, microtasks, queues and schedules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>或许这张图也更好理解些。<br><img src="https://cdn.nlark.com/yuque/0/2019/gif/128853/1560995436968-c6ff2732-4b20-49d4-852f-8c298eeb0d2e.gif#align=left&amp;display=inline&amp;height=341&amp;originHeight=341&amp;originWidth=611&amp;size=0&amp;status=done&amp;width=611" alt=""></p> <h2 id="例子2"><a href="#例子2" class="header-anchor">#</a> 例子2</h2> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2 end'</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise'</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="详细过程："><a href="#详细过程：" class="header-anchor">#</a> <strong>详细过程：</strong></h3> <p><strong>73以下版本</strong></p> <ul><li>首先，打印<code>script start</code>，调用<code>async1()</code>时，返回一个<code>Promise</code>，所以打印出来<code>async2 end</code>。</li> <li>每个 <code>await</code>，会新产生一个<code>promise</code>,但这个过程本身是异步的，所以该<code>await</code>后面不会立即调用。</li> <li>继续执行同步代码，打印<code>Promise</code>和<code>script end</code>，将<code>then</code>函数放入<strong>微任务</strong>队列中等待执行。</li> <li>同步执行完成之后，检查<strong>微任务</strong>队列是否为<code>null</code>，然后按照先入先出规则，依次执行。</li> <li>然后先执行打印<code>promise1</code>,此时<code>then</code>的回调函数返回<code>undefinde</code>，此时又有<code>then</code>的链式调用，又放入<strong>微任务</strong>队列中，再次打印<code>promise2</code>。</li> <li>再回到<code>await</code>的位置执行返回的 <code>Promise</code> 的 <code>resolve</code> 函数，这又会把 <code>resolve</code> 丢到微任务队列中，打印<code>async1 end</code>。</li> <li>当<strong>微任务</strong>队列为空时，执行宏任务,打印<code>setTimeout</code>。</li></ul> <p><strong>谷歌（金丝雀73版本）</strong></p> <ul><li>如果传递给 <code>await</code> 的值已经是一个 <code>Promise</code>，那么这种优化避免了再次创建 <code>Promise</code> 包装器，在这种情况下，我们从最少三个 <code>microtick</code> 到只有一个 <code>microtick</code>。</li> <li>引擎不再需要为 <code>await</code> 创造 <code>throwaway Promise</code> - 在绝大部分时间。</li> <li>现在 <code>promise</code> 指向了同一个 <code>Promise</code>，所以这个步骤什么也不需要做。然后引擎继续像以前一样，创建 <code>throwaway Promise</code>，安排 <code>PromiseReactionJob</code> 在 <code>microtask</code> 队列的下一个 <code>tick</code> 上恢复异步函数，暂停执行该函数，然后返回给调用者。</li></ul> <p>详情查看（<a href="https://link.juejin.im/?target=https%3A%2F%2Fv8.js.cn%2Fblog%2Ffast-async%2F" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p> <h2 id="nodejs的event-loop"><a href="#nodejs的event-loop" class="header-anchor">#</a> NodeJS的Event Loop</h2> <p><img src="https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436966-ae34b24c-83d0-4472-8854-1552abd9fcdb.webp#align=left&amp;display=inline&amp;height=223&amp;originHeight=223&amp;originWidth=543&amp;size=0&amp;status=done&amp;width=543" alt=""><br><code>Node</code>中的<code>Event Loop</code>是基于<code>libuv</code>实现的，而<code>libuv</code>是 <code>Node</code> 的新跨平台抽象层，libuv使用异步，事件驱动的编程方式，核心是提供<code>i/o</code>的事件循环和异步回调。libuv的<code>API</code>包含有时间，非阻塞的网络，异步文件操作，子进程等等。 <code>Event Loop</code>就是在<code>libuv</code>中实现的。<br><img src="https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436946-e5bcfbd1-340e-4c68-a14e-cd000081eef4.webp#align=left&amp;display=inline&amp;height=442&amp;originHeight=442&amp;originWidth=745&amp;size=0&amp;status=done&amp;width=745" alt=""> <a name="4clmy"></a></p> <h3 id="node的event-loop一共分为6个阶段，每个细节具体如下："><a href="#node的event-loop一共分为6个阶段，每个细节具体如下：" class="header-anchor">#</a> <code>Node</code>的<code>Event loop</code>一共分为6个阶段，每个细节具体如下：</h3> <ul><li><code>timers</code>: 执行<code>setTimeout</code>和<code>setInterval</code>中到期的<code>callback</code>。</li> <li><code>pending callback</code>: 上一轮循环中少数的<code>callback</code>会放在这一阶段执行。</li> <li><code>idle, prepare</code>: 仅在内部使用。</li> <li><code>poll</code>: 最重要的阶段，执行<code>pending callback</code>，在适当的情况下回阻塞在这个阶段。</li> <li><code>check</code>: 执行<code>setImmediate</code>(<code>setImmediate()</code>是将事件插入到事件队列尾部，主线程和事件队列的函数执行完成之后立即执行<code>setImmediate</code>指定的回调函数)的<code>callback</code>。</li> <li><code>close callbacks</code>: 执行<code>close</code>事件的<code>callback</code>，例如<code>socket.on('close'[,fn])</code>或者<code>http.server.on('close, fn)</code>。</li></ul> <p>具体细节如下：
<a name="qYgPm"></a></p> <h3 id="timers"><a href="#timers" class="header-anchor">#</a> timers</h3> <p>执行<code>setTimeout</code>和<code>setInterval</code>中到期的<code>callback</code>，执行这两者回调需要设置一个毫秒数，理论上来说，应该是时间一到就立即执行callback回调，但是由于<code>system</code>的调度可能会延时，达不到预期时间。<br>以下是官网文档解释的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">someAsyncOperation</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Assume this takes 95ms to complete</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/path/to/file'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> timeoutScheduled <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> delay <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timeoutScheduled<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delay<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms have passed since I was scheduled</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// do someAsyncOperation which takes 95 ms to complete</span>
<span class="token function">someAsyncOperation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> startCallback <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// do something that will take 10ms...</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startCallback <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do nothing</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>当进入事件循环时，它有一个空队列（<code>fs.readFile()</code>尚未完成），因此定时器将等待剩余毫秒数，当到达95ms时，<code>fs.readFile()</code>完成读取文件并且其完成需要10毫秒的回调被添加到轮询队列并执行。<br>当回调结束时，队列中不再有回调，因此事件循环将看到已达到最快定时器的<strong>阈值</strong>，然后回到<strong>timers阶段</strong>以执行定时器的回调。<br>在此示例中，您将看到正在调度的计时器与正在执行的回调之间的总延迟将为105毫秒。<br><strong>以下是我测试时间：</strong><br><img src="https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436982-2f817b92-3c4a-4d4c-8f95-92f63efa336c.webp#align=left&amp;display=inline&amp;height=430&amp;originHeight=430&amp;originWidth=724&amp;size=0&amp;status=done&amp;width=724" alt=""> <a name="sLxqs"></a></p> <h3 id="pending-callbacks"><a href="#pending-callbacks" class="header-anchor">#</a> pending callbacks</h3> <p>此阶段执行某些系统操作（例如TCP错误类型）的回调。 例如，如果<code>TCP socket ECONNREFUSED</code>在尝试connect时receives，则某些* nix系统希望等待报告错误。 这将在<code>pending callbacks</code>阶段执行。
<a name="3rwhp"></a></p> <h3 id="poll"><a href="#poll" class="header-anchor">#</a> poll</h3> <p><strong>该poll阶段有两个主要功能：</strong></p> <ul><li>执行<code>I/O</code>回调。</li> <li>处理轮询队列中的事件。</li></ul> <p><strong>当事件循环进入<code>poll</code>阶段并且在<code>timers</code>中没有可以执行定时器时，将发生以下两种情况之一</strong></p> <ul><li>如果<code>poll</code>队列不为空，则事件循环将遍历其同步执行它们的<code>callback</code>队列，直到队列为空，或者达到<code>system-dependent</code>（系统相关限制）。</li></ul> <p><strong>如果<code>poll</code>队列为空，则会发生以下两种情况之一</strong></p> <ul><li>如果有<code>setImmediate()</code>回调需要执行，则会立即停止执行<code>poll</code>阶段并进入执行<code>check</code>阶段以执行回调。<br></li> <li>如果没有<code>setImmediate()</code>回到需要执行，poll阶段将等待<code>callback</code>被添加到队列中，然后立即执行。<br></li></ul> <p><strong>当然设定了 timer 的话且 poll 队列为空，则会判断是否有 timer 超时，如果有的话会回到 timer 阶段执行回调。</strong> <a name="aZTtj"></a></p> <h3 id="check"><a href="#check" class="header-anchor">#</a> check</h3> <p><strong>此阶段允许人员在poll阶段完成后立即执行回调。</strong><br>如果<code>poll</code>阶段闲置并且<code>script</code>已排队<code>setImmediate()</code>，则事件循环到达check阶段执行而不是继续等待。<br><code>setImmediate()</code>实际上是一个特殊的计时器，它在事件循环的一个单独阶段运行。它使用<code>libuv API</code>来调度在<code>poll</code>阶段完成后执行的回调。<br>通常，当代码被执行时，事件循环最终将达到<code>poll</code>阶段，它将等待传入连接，请求等。<br>但是，如果已经调度了回调<code>setImmediate()</code>，并且轮询阶段变为空闲，则它将结束并且到达<code>check</code>阶段，而不是等待<code>poll</code>事件。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>

</code></pre></div><p>如果<code>node</code>版本为<code>v11.x</code>， 其结果与浏览器一致。</p> <div class="language-js extra-class"><pre class="language-js"><code>start
end
promise3
timer1
promise1
timer2
promise2

</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p><a href="https://github.com/xiaomuzhu/front-end-interview/blob/master/docs/guide/eventLoop.md" target="_blank" rel="noopener noreferrer">https://github.com/xiaomuzhu/front-end-interview/blob/master/docs/guide/eventLoop.md<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://v8.js.cn/blog/fast-async/" target="_blank" rel="noopener noreferrer">https://v8.js.cn/blog/fast-async/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setImmediate" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setImmediate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="http://javascript.ruanyifeng.com/dom/mutationobserver.html" target="_blank" rel="noopener noreferrer">http://javascript.ruanyifeng.com/dom/mutationobserver.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener noreferrer">https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/syun0216/Front-end-notes/edit/master//JavaScript/js原理/EventLoop详解.md" target="_blank" rel="noopener noreferrer">在Github上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/7/2019, 3:12:20 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Front-end-notes/JavaScript/js原理/DOM事件.html" class="prev">DOM事件</a></span> <span class="next"><a href="/Front-end-notes/JavaScript/js原理/JavaScript的内存管理.html">JavaScript的内存管理</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Front-end-notes/assets/js/app.36d15ab6.js" defer></script><script src="/Front-end-notes/assets/js/2.4bda1855.js" defer></script><script src="/Front-end-notes/assets/js/33.91f4989b.js" defer></script>
  </body>
</html>
