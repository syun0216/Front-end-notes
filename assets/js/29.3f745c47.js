(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{306:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"event-loop详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#event-loop详解"}},[t._v("#")]),t._v(" Event Loop详解")]),t._v(" "),a("p",[t._v("Event loop 即时间循环，是指浏览器或Node的解决JavaScript单线程运行时不会阻塞的一直机制，也就是我们经常使用异步的原理。")]),t._v(" "),a("h2",{attrs:{id:"栈、队列的基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#栈、队列的基本概念"}},[t._v("#")]),t._v(" 栈、队列的基本概念")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995437042-9d683636-9bf5-45fb-8cf3-e482b94a707d.webp#align=left&display=inline&height=271&originHeight=271&originWidth=294&size=0&status=done&width=294",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"栈（stack）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#栈（stack）"}},[t._v("#")]),t._v(" 栈（stack）")]),t._v(" "),a("p",[t._v("栈在计算机科学中是限定仅在"),a("strong",[t._v("表尾")]),t._v("进行插入或者删除操作的线性表。"),a("strong",[t._v("栈")]),t._v("是一种数据结构，按照后进先出的原则存储数据，先进入的数据被压在栈底，需要读数据的时候从栈顶开始弹出数据。栈是只能某一端插入和删除的特殊线性表。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436902-6dcf8420-be5b-4dd9-9fb6-43e567e53c86.webp#align=left&display=inline&height=282&originHeight=282&originWidth=616&size=0&status=done&width=616",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"队列（queue）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#队列（queue）"}},[t._v("#")]),t._v(" 队列（Queue）")]),t._v(" "),a("p",[t._v("只允许在表的前端进行删除，而在表的后端进行插入操作，和栈一样，队列是一种操作受限制的线性表。")]),t._v(" "),a("ul",[a("li",[t._v("队尾：进行插入操作")]),t._v(" "),a("li",[t._v("队头：进行删除操作")]),t._v(" "),a("li",[t._v("空队列：队列中没有数据")]),t._v(" "),a("li",[t._v("队列元素：队列中的数据元素")])]),t._v(" "),a("p",[t._v("遵循规则为先进先出（FIFO - first in first out）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436932-57cb6ee5-763a-47b2-a0be-4174c4fd1c66.webp#align=left&display=inline&height=270&originHeight=270&originWidth=554&size=0&status=done&width=554",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#event-loop"}},[t._v("#")]),t._v(" Event Loop")]),t._v(" "),a("p",[t._v("在js中，任务分两种，一种叫宏任务(MacroTask、Task)、一种叫微任务(MicroTack);")]),t._v(" "),a("h3",{attrs:{id:"macrotask"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#macrotask"}},[t._v("#")]),t._v(" MacroTask")]),t._v(" "),a("p",[t._v("script内全部代码、setTimeout、setInterval、setImmediate(ie 10)、I/O、UI Rendering.")]),t._v(" "),a("h3",{attrs:{id:"microtask"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#microtask"}},[t._v("#")]),t._v(" MicroTask")]),t._v(" "),a("p",[t._v("Process.nextTick(Node)、Promise、Object.observe(废弃)、MutationObserver")]),t._v(" "),a("h3",{attrs:{id:"浏览器中的event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器中的event-loop"}},[t._v("#")]),t._v(" 浏览器中的Event Loop")]),t._v(" "),a("p",[t._v("js有一个main thread主线程和callstack执行栈，所有任务都会被放到执行栈中等待主线程执行。")]),t._v(" "),a("h3",{attrs:{id:"js调用栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js调用栈"}},[t._v("#")]),t._v(" js调用栈")]),t._v(" "),a("p",[t._v("hs调用栈采用的是后进先出的规则，当函数执行的时候，会被添加到栈的顶部，当执行栈执行完后，就会从栈顶移出，知道栈内被清空。")]),t._v(" "),a("h3",{attrs:{id:"同步任务和异步任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步任务和异步任务"}},[t._v("#")]),t._v(" 同步任务和异步任务")]),t._v(" "),a("p",[t._v("js单线程任务被氛围同步任务和异步任务，同步任务会在调用栈中按照顺序等待主线程一次执行，异步任务会在异步任务有了结果后，将注册的回调函数放到任务队列中等待主线程空闲的时候（调用栈被清空），被读取到栈内等待主线程的执行。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436925-9ac8fb38-4dfd-4d12-b5fe-c564ede43f80.webp#align=left&display=inline&height=518&originHeight=518&originWidth=636&size=0&status=done&width=636",alt:""}})]),t._v(" "),a("p",[t._v("任务队列Task Queue是一种先进先出的数据结构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995437021-43545b5b-0a48-475a-a8a6-cce80433fe1a.webp#align=left&display=inline&height=669&originHeight=669&originWidth=800&size=0&status=done&width=800",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"时间循环的进程模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#时间循环的进程模型"}},[t._v("#")]),t._v(" 时间循环的进程模型")]),t._v(" "),a("ul",[a("li",[t._v("选择任务队列中最先进入的任务，当任务队列为空，则执行微任务")]),t._v(" "),a("li",[t._v("时间循环中的任务设置为已选择任务")]),t._v(" "),a("li",[t._v("执行任务")]),t._v(" "),a("li",[t._v("将事件循环中的当前运行任务设置为null")]),t._v(" "),a("li",[t._v("将已经完成的任务从任务队列中删除")]),t._v(" "),a("li",[t._v("microtasks步骤：进入microtask检查点")]),t._v(" "),a("li",[t._v("更新界面渲染")]),t._v(" "),a("li",[t._v("返回第一步")])]),t._v(" "),a("h3",{attrs:{id:"执行microtasks时有以下步骤："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行microtasks时有以下步骤："}},[t._v("#")]),t._v(" 执行microtasks时有以下步骤：")]),t._v(" "),a("ul",[a("li",[t._v("设置microtask检查点标志为true")]),t._v(" "),a("li",[t._v("当时间循环microtask执行不为空时，选择一个最先进入的microtask队列的microtask，将时间循环的microtask设置为已选择的microtask，运行microtask，将已经执行完成的microtask设为null，移出microtask中的microtask")]),t._v(" "),a("li",[t._v("清理indexDB事务")]),t._v(" "),a("li",[t._v("是指检查点为true")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/gif/128853/1560995436931-71f56a41-54d3-49f3-a382-c1e6acbf301e.gif#align=left&display=inline&height=589&originHeight=589&originWidth=1011&size=0&status=done&width=1011",alt:""}})]),t._v(" "),a("p",[t._v("执行栈在执行完"),a("strong",[t._v("同步任务")]),t._v("后，查看执行栈是否为空，如果执行栈为空，就会去检查"),a("strong",[t._v("微任务")]),t._v("(microTask)队列是否为空，如果为空的话，就执行Task（宏任务），否则就一次性执行完所有微任务。\n每次单个宏任务执行完毕后，检查"),a("strong",[t._v("微任务")]),t._v("(microTask)队列是否为空，如果不为空的话，会按照"),a("strong",[t._v("先入先出")]),t._v("的规则全部执行完微任务(microTask)后，设置微任务(microTask)队列为null，然后再执行"),a("strong",[t._v("宏任务")]),t._v("，如此循环。")]),t._v(" "),a("h2",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[t._v("#")]),t._v(" 例子")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script start'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nPromise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fjakearchibald.com%2F2015%2Ftasks-microtasks-queues-and-schedules%2F",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tasks, microtasks, queues and schedules"),a("OutboundLink")],1),a("br"),t._v("或许这张图也更好理解些。"),a("br"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/gif/128853/1560995436968-c6ff2732-4b20-49d4-852f-8c298eeb0d2e.gif#align=left&display=inline&height=341&originHeight=341&originWidth=611&size=0&status=done&width=611",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"例子2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子2"}},[t._v("#")]),t._v(" 例子2")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script start'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("async1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("async2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async1 end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("async2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async2 end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("async1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Promise'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"详细过程："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#详细过程："}},[t._v("#")]),t._v(" "),a("strong",[t._v("详细过程：")])]),t._v(" "),a("p",[a("strong",[t._v("73以下版本")])]),t._v(" "),a("ul",[a("li",[t._v("首先，打印"),a("code",[t._v("script start")]),t._v("，调用"),a("code",[t._v("async1()")]),t._v("时，返回一个"),a("code",[t._v("Promise")]),t._v("，所以打印出来"),a("code",[t._v("async2 end")]),t._v("。")]),t._v(" "),a("li",[t._v("每个 "),a("code",[t._v("await")]),t._v("，会新产生一个"),a("code",[t._v("promise")]),t._v(",但这个过程本身是异步的，所以该"),a("code",[t._v("await")]),t._v("后面不会立即调用。")]),t._v(" "),a("li",[t._v("继续执行同步代码，打印"),a("code",[t._v("Promise")]),t._v("和"),a("code",[t._v("script end")]),t._v("，将"),a("code",[t._v("then")]),t._v("函数放入"),a("strong",[t._v("微任务")]),t._v("队列中等待执行。")]),t._v(" "),a("li",[t._v("同步执行完成之后，检查"),a("strong",[t._v("微任务")]),t._v("队列是否为"),a("code",[t._v("null")]),t._v("，然后按照先入先出规则，依次执行。")]),t._v(" "),a("li",[t._v("然后先执行打印"),a("code",[t._v("promise1")]),t._v(",此时"),a("code",[t._v("then")]),t._v("的回调函数返回"),a("code",[t._v("undefinde")]),t._v("，此时又有"),a("code",[t._v("then")]),t._v("的链式调用，又放入"),a("strong",[t._v("微任务")]),t._v("队列中，再次打印"),a("code",[t._v("promise2")]),t._v("。")]),t._v(" "),a("li",[t._v("再回到"),a("code",[t._v("await")]),t._v("的位置执行返回的 "),a("code",[t._v("Promise")]),t._v(" 的 "),a("code",[t._v("resolve")]),t._v(" 函数，这又会把 "),a("code",[t._v("resolve")]),t._v(" 丢到微任务队列中，打印"),a("code",[t._v("async1 end")]),t._v("。")]),t._v(" "),a("li",[t._v("当"),a("strong",[t._v("微任务")]),t._v("队列为空时，执行宏任务,打印"),a("code",[t._v("setTimeout")]),t._v("。")])]),t._v(" "),a("p",[a("strong",[t._v("谷歌（金丝雀73版本）")])]),t._v(" "),a("ul",[a("li",[t._v("如果传递给 "),a("code",[t._v("await")]),t._v(" 的值已经是一个 "),a("code",[t._v("Promise")]),t._v("，那么这种优化避免了再次创建 "),a("code",[t._v("Promise")]),t._v(" 包装器，在这种情况下，我们从最少三个 "),a("code",[t._v("microtick")]),t._v(" 到只有一个 "),a("code",[t._v("microtick")]),t._v("。")]),t._v(" "),a("li",[t._v("引擎不再需要为 "),a("code",[t._v("await")]),t._v(" 创造 "),a("code",[t._v("throwaway Promise")]),t._v(" - 在绝大部分时间。")]),t._v(" "),a("li",[t._v("现在 "),a("code",[t._v("promise")]),t._v(" 指向了同一个 "),a("code",[t._v("Promise")]),t._v("，所以这个步骤什么也不需要做。然后引擎继续像以前一样，创建 "),a("code",[t._v("throwaway Promise")]),t._v("，安排 "),a("code",[t._v("PromiseReactionJob")]),t._v(" 在 "),a("code",[t._v("microtask")]),t._v(" 队列的下一个 "),a("code",[t._v("tick")]),t._v(" 上恢复异步函数，暂停执行该函数，然后返回给调用者。")])]),t._v(" "),a("p",[t._v("详情查看（"),a("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fv8.js.cn%2Fblog%2Ffast-async%2F",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1),t._v("）")]),t._v(" "),a("h2",{attrs:{id:"nodejs的event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs的event-loop"}},[t._v("#")]),t._v(" NodeJS的Event Loop")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436966-ae34b24c-83d0-4472-8854-1552abd9fcdb.webp#align=left&display=inline&height=223&originHeight=223&originWidth=543&size=0&status=done&width=543",alt:""}}),a("br"),a("code",[t._v("Node")]),t._v("中的"),a("code",[t._v("Event Loop")]),t._v("是基于"),a("code",[t._v("libuv")]),t._v("实现的，而"),a("code",[t._v("libuv")]),t._v("是 "),a("code",[t._v("Node")]),t._v(" 的新跨平台抽象层，libuv使用异步，事件驱动的编程方式，核心是提供"),a("code",[t._v("i/o")]),t._v("的事件循环和异步回调。libuv的"),a("code",[t._v("API")]),t._v("包含有时间，非阻塞的网络，异步文件操作，子进程等等。 "),a("code",[t._v("Event Loop")]),t._v("就是在"),a("code",[t._v("libuv")]),t._v("中实现的。"),a("br"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436946-e5bcfbd1-340e-4c68-a14e-cd000081eef4.webp#align=left&display=inline&height=442&originHeight=442&originWidth=745&size=0&status=done&width=745",alt:""}}),t._v(" "),a("a",{attrs:{name:"4clmy"}})]),t._v(" "),a("h3",{attrs:{id:"node的event-loop一共分为6个阶段，每个细节具体如下："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node的event-loop一共分为6个阶段，每个细节具体如下："}},[t._v("#")]),t._v(" "),a("code",[t._v("Node")]),t._v("的"),a("code",[t._v("Event loop")]),t._v("一共分为6个阶段，每个细节具体如下：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("timers")]),t._v(": 执行"),a("code",[t._v("setTimeout")]),t._v("和"),a("code",[t._v("setInterval")]),t._v("中到期的"),a("code",[t._v("callback")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("pending callback")]),t._v(": 上一轮循环中少数的"),a("code",[t._v("callback")]),t._v("会放在这一阶段执行。")]),t._v(" "),a("li",[a("code",[t._v("idle, prepare")]),t._v(": 仅在内部使用。")]),t._v(" "),a("li",[a("code",[t._v("poll")]),t._v(": 最重要的阶段，执行"),a("code",[t._v("pending callback")]),t._v("，在适当的情况下回阻塞在这个阶段。")]),t._v(" "),a("li",[a("code",[t._v("check")]),t._v(": 执行"),a("code",[t._v("setImmediate")]),t._v("("),a("code",[t._v("setImmediate()")]),t._v("是将事件插入到事件队列尾部，主线程和事件队列的函数执行完成之后立即执行"),a("code",[t._v("setImmediate")]),t._v("指定的回调函数)的"),a("code",[t._v("callback")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("close callbacks")]),t._v(": 执行"),a("code",[t._v("close")]),t._v("事件的"),a("code",[t._v("callback")]),t._v("，例如"),a("code",[t._v("socket.on('close'[,fn])")]),t._v("或者"),a("code",[t._v("http.server.on('close, fn)")]),t._v("。")])]),t._v(" "),a("p",[t._v("具体细节如下：\n"),a("a",{attrs:{name:"qYgPm"}})]),t._v(" "),a("h3",{attrs:{id:"timers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timers"}},[t._v("#")]),t._v(" timers")]),t._v(" "),a("p",[t._v("执行"),a("code",[t._v("setTimeout")]),t._v("和"),a("code",[t._v("setInterval")]),t._v("中到期的"),a("code",[t._v("callback")]),t._v("，执行这两者回调需要设置一个毫秒数，理论上来说，应该是时间一到就立即执行callback回调，但是由于"),a("code",[t._v("system")]),t._v("的调度可能会延时，达不到预期时间。"),a("br"),t._v("以下是官网文档解释的例子：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("someAsyncOperation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Assume this takes 95ms to complete")]),t._v("\n  fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/file'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" timeoutScheduled "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" delay "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timeoutScheduled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("delay"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("ms have passed since I was scheduled")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do someAsyncOperation which takes 95 ms to complete")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("someAsyncOperation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" startCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something that will take 10ms...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" startCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do nothing")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[t._v("当进入事件循环时，它有一个空队列（"),a("code",[t._v("fs.readFile()")]),t._v("尚未完成），因此定时器将等待剩余毫秒数，当到达95ms时，"),a("code",[t._v("fs.readFile()")]),t._v("完成读取文件并且其完成需要10毫秒的回调被添加到轮询队列并执行。"),a("br"),t._v("当回调结束时，队列中不再有回调，因此事件循环将看到已达到最快定时器的"),a("strong",[t._v("阈值")]),t._v("，然后回到"),a("strong",[t._v("timers阶段")]),t._v("以执行定时器的回调。"),a("br"),t._v("在此示例中，您将看到正在调度的计时器与正在执行的回调之间的总延迟将为105毫秒。"),a("br"),a("strong",[t._v("以下是我测试时间：")]),a("br"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/128853/1560995436982-2f817b92-3c4a-4d4c-8f95-92f63efa336c.webp#align=left&display=inline&height=430&originHeight=430&originWidth=724&size=0&status=done&width=724",alt:""}}),t._v(" "),a("a",{attrs:{name:"sLxqs"}})]),t._v(" "),a("h3",{attrs:{id:"pending-callbacks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pending-callbacks"}},[t._v("#")]),t._v(" pending callbacks")]),t._v(" "),a("p",[t._v("此阶段执行某些系统操作（例如TCP错误类型）的回调。 例如，如果"),a("code",[t._v("TCP socket ECONNREFUSED")]),t._v("在尝试connect时receives，则某些* nix系统希望等待报告错误。 这将在"),a("code",[t._v("pending callbacks")]),t._v("阶段执行。\n"),a("a",{attrs:{name:"3rwhp"}})]),t._v(" "),a("h3",{attrs:{id:"poll"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#poll"}},[t._v("#")]),t._v(" poll")]),t._v(" "),a("p",[a("strong",[t._v("该poll阶段有两个主要功能：")])]),t._v(" "),a("ul",[a("li",[t._v("执行"),a("code",[t._v("I/O")]),t._v("回调。")]),t._v(" "),a("li",[t._v("处理轮询队列中的事件。")])]),t._v(" "),a("p",[a("strong",[t._v("当事件循环进入"),a("code",[t._v("poll")]),t._v("阶段并且在"),a("code",[t._v("timers")]),t._v("中没有可以执行定时器时，将发生以下两种情况之一")])]),t._v(" "),a("ul",[a("li",[t._v("如果"),a("code",[t._v("poll")]),t._v("队列不为空，则事件循环将遍历其同步执行它们的"),a("code",[t._v("callback")]),t._v("队列，直到队列为空，或者达到"),a("code",[t._v("system-dependent")]),t._v("（系统相关限制）。")])]),t._v(" "),a("p",[a("strong",[t._v("如果"),a("code",[t._v("poll")]),t._v("队列为空，则会发生以下两种情况之一")])]),t._v(" "),a("ul",[a("li",[t._v("如果有"),a("code",[t._v("setImmediate()")]),t._v("回调需要执行，则会立即停止执行"),a("code",[t._v("poll")]),t._v("阶段并进入执行"),a("code",[t._v("check")]),t._v("阶段以执行回调。"),a("br")]),t._v(" "),a("li",[t._v("如果没有"),a("code",[t._v("setImmediate()")]),t._v("回到需要执行，poll阶段将等待"),a("code",[t._v("callback")]),t._v("被添加到队列中，然后立即执行。"),a("br")])]),t._v(" "),a("p",[a("strong",[t._v("当然设定了 timer 的话且 poll 队列为空，则会判断是否有 timer 超时，如果有的话会回到 timer 阶段执行回调。")]),t._v(" "),a("a",{attrs:{name:"aZTtj"}})]),t._v(" "),a("h3",{attrs:{id:"check"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#check"}},[t._v("#")]),t._v(" check")]),t._v(" "),a("p",[a("strong",[t._v("此阶段允许人员在poll阶段完成后立即执行回调。")]),a("br"),t._v("如果"),a("code",[t._v("poll")]),t._v("阶段闲置并且"),a("code",[t._v("script")]),t._v("已排队"),a("code",[t._v("setImmediate()")]),t._v("，则事件循环到达check阶段执行而不是继续等待。"),a("br"),a("code",[t._v("setImmediate()")]),t._v("实际上是一个特殊的计时器，它在事件循环的一个单独阶段运行。它使用"),a("code",[t._v("libuv API")]),t._v("来调度在"),a("code",[t._v("poll")]),t._v("阶段完成后执行的回调。"),a("br"),t._v("通常，当代码被执行时，事件循环最终将达到"),a("code",[t._v("poll")]),t._v("阶段，它将等待传入连接，请求等。"),a("br"),t._v("但是，如果已经调度了回调"),a("code",[t._v("setImmediate()")]),t._v("，并且轮询阶段变为空闲，则它将结束并且到达"),a("code",[t._v("check")]),t._v("阶段，而不是等待"),a("code",[t._v("poll")]),t._v("事件。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'start'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nPromise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[t._v("如果"),a("code",[t._v("node")]),t._v("版本为"),a("code",[t._v("v11.x")]),t._v("， 其结果与浏览器一致。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("start\nend\npromise3\ntimer1\npromise1\ntimer2\npromise2\n\n")])])]),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/xiaomuzhu/front-end-interview/blob/master/docs/guide/eventLoop.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xiaomuzhu/front-end-interview/blob/master/docs/guide/eventLoop.md"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://v8.js.cn/blog/fast-async/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://v8.js.cn/blog/fast-async/"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setImmediate",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setImmediate"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"http://javascript.ruanyifeng.com/dom/mutationobserver.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://javascript.ruanyifeng.com/dom/mutationobserver.html"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);