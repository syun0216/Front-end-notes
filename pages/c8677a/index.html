<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Promise&amp;Generator | Junwen&#39;s home</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="shortcut icon" type="image/x-icon" href="/Front-end-notes/img/favicon.ico">
    <meta name="description" content="">
    <link rel="preload" href="/Front-end-notes/assets/css/0.styles.cbc308f8.css" as="style"><link rel="preload" href="/Front-end-notes/assets/js/app.adb127c3.js" as="script"><link rel="preload" href="/Front-end-notes/assets/js/2.d7e66a74.js" as="script"><link rel="preload" href="/Front-end-notes/assets/js/35.69d0c608.js" as="script"><link rel="prefetch" href="/Front-end-notes/assets/js/10.8991d4b8.js"><link rel="prefetch" href="/Front-end-notes/assets/js/100.c425c5c0.js"><link rel="prefetch" href="/Front-end-notes/assets/js/101.a329be56.js"><link rel="prefetch" href="/Front-end-notes/assets/js/102.7fe4b75c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/103.5e35c916.js"><link rel="prefetch" href="/Front-end-notes/assets/js/104.d431bc4d.js"><link rel="prefetch" href="/Front-end-notes/assets/js/105.f8c5d060.js"><link rel="prefetch" href="/Front-end-notes/assets/js/106.565c9ff7.js"><link rel="prefetch" href="/Front-end-notes/assets/js/107.7307d975.js"><link rel="prefetch" href="/Front-end-notes/assets/js/108.b4e2a93d.js"><link rel="prefetch" href="/Front-end-notes/assets/js/109.2ec423aa.js"><link rel="prefetch" href="/Front-end-notes/assets/js/11.b1d4f23f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/110.c09e2ef6.js"><link rel="prefetch" href="/Front-end-notes/assets/js/111.2089d21e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/112.ae02bd44.js"><link rel="prefetch" href="/Front-end-notes/assets/js/113.7cafca00.js"><link rel="prefetch" href="/Front-end-notes/assets/js/114.1aec6549.js"><link rel="prefetch" href="/Front-end-notes/assets/js/115.f4b4a4f7.js"><link rel="prefetch" href="/Front-end-notes/assets/js/116.fe2853bf.js"><link rel="prefetch" href="/Front-end-notes/assets/js/117.49dd458e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/118.0d8d9963.js"><link rel="prefetch" href="/Front-end-notes/assets/js/119.c081f31f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/12.2bf515c7.js"><link rel="prefetch" href="/Front-end-notes/assets/js/120.838ef435.js"><link rel="prefetch" href="/Front-end-notes/assets/js/121.3d9461de.js"><link rel="prefetch" href="/Front-end-notes/assets/js/122.5b95c8b4.js"><link rel="prefetch" href="/Front-end-notes/assets/js/123.f839617c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/124.44fa7a69.js"><link rel="prefetch" href="/Front-end-notes/assets/js/125.e75a4a62.js"><link rel="prefetch" href="/Front-end-notes/assets/js/126.b227a63a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/127.239d00af.js"><link rel="prefetch" href="/Front-end-notes/assets/js/128.2c744447.js"><link rel="prefetch" href="/Front-end-notes/assets/js/129.19a0b6a1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/13.83500c63.js"><link rel="prefetch" href="/Front-end-notes/assets/js/130.4273a75f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/131.d6ec3158.js"><link rel="prefetch" href="/Front-end-notes/assets/js/132.19c9d9e1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/133.678f462f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/134.ee097c9a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/135.a376326f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/136.8ffc59ac.js"><link rel="prefetch" href="/Front-end-notes/assets/js/137.9ca0c34e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/138.5b757dee.js"><link rel="prefetch" href="/Front-end-notes/assets/js/139.696bdcdd.js"><link rel="prefetch" href="/Front-end-notes/assets/js/14.e3a54507.js"><link rel="prefetch" href="/Front-end-notes/assets/js/140.052f5b88.js"><link rel="prefetch" href="/Front-end-notes/assets/js/141.0379e1d8.js"><link rel="prefetch" href="/Front-end-notes/assets/js/15.dc7d3c2a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/16.c95d76c1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/17.f96cfb47.js"><link rel="prefetch" href="/Front-end-notes/assets/js/18.4af8a963.js"><link rel="prefetch" href="/Front-end-notes/assets/js/19.aa5e57a2.js"><link rel="prefetch" href="/Front-end-notes/assets/js/20.dcd2b767.js"><link rel="prefetch" href="/Front-end-notes/assets/js/21.23b7f9cc.js"><link rel="prefetch" href="/Front-end-notes/assets/js/22.af781859.js"><link rel="prefetch" href="/Front-end-notes/assets/js/23.93f3a119.js"><link rel="prefetch" href="/Front-end-notes/assets/js/24.4007704c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/25.057b91be.js"><link rel="prefetch" href="/Front-end-notes/assets/js/26.aed47ce1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/27.0b8f6b09.js"><link rel="prefetch" href="/Front-end-notes/assets/js/28.42c8610a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/29.ff7bbe48.js"><link rel="prefetch" href="/Front-end-notes/assets/js/3.a00cbf37.js"><link rel="prefetch" href="/Front-end-notes/assets/js/30.1dd29976.js"><link rel="prefetch" href="/Front-end-notes/assets/js/31.ffb41b0a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/32.fb0faffe.js"><link rel="prefetch" href="/Front-end-notes/assets/js/33.b72bce43.js"><link rel="prefetch" href="/Front-end-notes/assets/js/34.8c5f44e9.js"><link rel="prefetch" href="/Front-end-notes/assets/js/36.88c17cd4.js"><link rel="prefetch" href="/Front-end-notes/assets/js/37.5e2e7865.js"><link rel="prefetch" href="/Front-end-notes/assets/js/38.708de80a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/39.a3bac3d1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/4.28029aa3.js"><link rel="prefetch" href="/Front-end-notes/assets/js/40.5507e580.js"><link rel="prefetch" href="/Front-end-notes/assets/js/41.20ecedab.js"><link rel="prefetch" href="/Front-end-notes/assets/js/42.e7d5a7d1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/43.3fad461e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/44.e901d09f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/45.795b48c6.js"><link rel="prefetch" href="/Front-end-notes/assets/js/46.11883b99.js"><link rel="prefetch" href="/Front-end-notes/assets/js/47.9e3d3264.js"><link rel="prefetch" href="/Front-end-notes/assets/js/48.fba92a3d.js"><link rel="prefetch" href="/Front-end-notes/assets/js/49.eb14a0ad.js"><link rel="prefetch" href="/Front-end-notes/assets/js/5.343710c8.js"><link rel="prefetch" href="/Front-end-notes/assets/js/50.c8995b7a.js"><link rel="prefetch" href="/Front-end-notes/assets/js/51.3343b4cf.js"><link rel="prefetch" href="/Front-end-notes/assets/js/52.a99402d7.js"><link rel="prefetch" href="/Front-end-notes/assets/js/53.f9c19ffe.js"><link rel="prefetch" href="/Front-end-notes/assets/js/54.f762523f.js"><link rel="prefetch" href="/Front-end-notes/assets/js/55.e119b316.js"><link rel="prefetch" href="/Front-end-notes/assets/js/56.a02912f3.js"><link rel="prefetch" href="/Front-end-notes/assets/js/57.c3d418d4.js"><link rel="prefetch" href="/Front-end-notes/assets/js/58.cbd46e5b.js"><link rel="prefetch" href="/Front-end-notes/assets/js/59.83cb5f09.js"><link rel="prefetch" href="/Front-end-notes/assets/js/6.551c5890.js"><link rel="prefetch" href="/Front-end-notes/assets/js/60.cc8d6c71.js"><link rel="prefetch" href="/Front-end-notes/assets/js/61.7fd694f1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/62.289fcc4d.js"><link rel="prefetch" href="/Front-end-notes/assets/js/63.4840c864.js"><link rel="prefetch" href="/Front-end-notes/assets/js/64.3a294b4c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/65.14e3b6c9.js"><link rel="prefetch" href="/Front-end-notes/assets/js/66.dde43cae.js"><link rel="prefetch" href="/Front-end-notes/assets/js/67.45ee1506.js"><link rel="prefetch" href="/Front-end-notes/assets/js/68.dff6c960.js"><link rel="prefetch" href="/Front-end-notes/assets/js/69.40cf39e6.js"><link rel="prefetch" href="/Front-end-notes/assets/js/7.204cc655.js"><link rel="prefetch" href="/Front-end-notes/assets/js/70.6f671206.js"><link rel="prefetch" href="/Front-end-notes/assets/js/71.5035e4f9.js"><link rel="prefetch" href="/Front-end-notes/assets/js/72.751f1895.js"><link rel="prefetch" href="/Front-end-notes/assets/js/73.03fbd135.js"><link rel="prefetch" href="/Front-end-notes/assets/js/74.85622020.js"><link rel="prefetch" href="/Front-end-notes/assets/js/75.899476ac.js"><link rel="prefetch" href="/Front-end-notes/assets/js/76.aa41cfb7.js"><link rel="prefetch" href="/Front-end-notes/assets/js/77.17d483e8.js"><link rel="prefetch" href="/Front-end-notes/assets/js/78.6bad78a1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/79.03523e33.js"><link rel="prefetch" href="/Front-end-notes/assets/js/8.076b1233.js"><link rel="prefetch" href="/Front-end-notes/assets/js/80.fe2d1f42.js"><link rel="prefetch" href="/Front-end-notes/assets/js/81.77ac1de1.js"><link rel="prefetch" href="/Front-end-notes/assets/js/82.12113302.js"><link rel="prefetch" href="/Front-end-notes/assets/js/83.ea99b0a2.js"><link rel="prefetch" href="/Front-end-notes/assets/js/84.f446c10b.js"><link rel="prefetch" href="/Front-end-notes/assets/js/85.ac21a748.js"><link rel="prefetch" href="/Front-end-notes/assets/js/86.dda97a45.js"><link rel="prefetch" href="/Front-end-notes/assets/js/87.8884d6fc.js"><link rel="prefetch" href="/Front-end-notes/assets/js/88.80b68c92.js"><link rel="prefetch" href="/Front-end-notes/assets/js/89.9ff301d5.js"><link rel="prefetch" href="/Front-end-notes/assets/js/9.f38a58a5.js"><link rel="prefetch" href="/Front-end-notes/assets/js/90.b4e07752.js"><link rel="prefetch" href="/Front-end-notes/assets/js/91.325ec7fa.js"><link rel="prefetch" href="/Front-end-notes/assets/js/92.f23455a4.js"><link rel="prefetch" href="/Front-end-notes/assets/js/93.ece0adce.js"><link rel="prefetch" href="/Front-end-notes/assets/js/94.46f7c0db.js"><link rel="prefetch" href="/Front-end-notes/assets/js/95.e5e6c608.js"><link rel="prefetch" href="/Front-end-notes/assets/js/96.86b8fbd4.js"><link rel="prefetch" href="/Front-end-notes/assets/js/97.0bcb1e5e.js"><link rel="prefetch" href="/Front-end-notes/assets/js/98.df412e8c.js"><link rel="prefetch" href="/Front-end-notes/assets/js/99.f5d26e1d.js">
    <link rel="stylesheet" href="/Front-end-notes/assets/css/0.styles.cbc308f8.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Front-end-notes/" class="home-link router-link-active"><!----> <span class="site-name">Junwen's home</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><a href="/Front-end-notes/JavaScript/" class="link-title">JavaScript</a> <span class="title" style="display:none;">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ES6</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/d9ebac/" class="nav-link">ES6 Decorator</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/780ea1/" class="nav-link">ES6核心特性</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/c8677a/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Promise&amp;Generator</a></li></ul></li><li class="dropdown-item"><h4>js原理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/1b56f1/" class="nav-link">简单实现bind、apply和call</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/abdbcb/" class="nav-link">如何遍历一个dom tree</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/a8d5a8/" class="nav-link">实现函数currying</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/2c3bf4/" class="nav-link">实现一个event</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/4eb0e3/" class="nav-link">详解js的继承</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/64db0d/" class="nav-link">详解requestAnimationFrame</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/12cc8e/" class="nav-link">Canvas api详解</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/185d72/" class="nav-link">DOM事件</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/c49367/" class="nav-link">EventLoop详解</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/b50bad/" class="nav-link">JavaScript的内存管理</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/38b7e6/" class="nav-link">JavaScript的运行机制</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/f16f62/" class="nav-link">Math对象</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/6cd659/" class="nav-link">new操作符都做了什么</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/46dbec/" class="nav-link">create基本实现原理</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/d980a4/" class="nav-link">Set、Map、WeakSet和WeakMap</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/674ecf/" class="nav-link">web worker原理</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/aa8fa2/" class="nav-link">WebGL教程(MDN)</a></li></ul></li><li class="dropdown-item"><h4>jsInfoSeries</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/7607c2/" class="nav-link">简介</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/422096/" class="nav-link">JavaScript基础知识</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/492e58/" class="nav-link">基础知识2</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/30968d/" class="nav-link">基础知识3</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/e139a1/" class="nav-link">基础知识4</a></li></ul></li><li class="dropdown-item"><h4>技巧</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/d7ece9/" class="nav-link"> 5个js解构有趣用途</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/c41df5/" class="nav-link">如何使用set提高代码性能</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/a66f47/" class="nav-link">cordova构建项目时的问题</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/662607/" class="nav-link">js中轻松遍历对象属性的几种方式</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><a href="/Front-end-notes/css/" class="link-title">CSS</a> <span class="title" style="display:none;">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/493b2e/" class="nav-link">怎么写出更好的css</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/f0604f/" class="nav-link">BFC详解</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/13ad2e/" class="nav-link">box-shadow详解</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/a07dbe/" class="nav-link">CSS小技巧</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/b81321/" class="nav-link">Grid布局详解</a></li></ul></div></div><div class="nav-item"><a href="/Front-end-notes/html/" class="nav-link">HTML</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><a href="/Front-end-notes/web/" class="link-title">网络</a> <span class="title" style="display:none;">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/6f3543/" class="nav-link">IP十问</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/34aa02/" class="nav-link">http笔试</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/13759c/" class="nav-link">http协议</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目构建" class="dropdown-title"><a href="/Front-end-notes/project/" class="link-title">项目构建</a> <span class="title" style="display:none;">项目构建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/8f406e/" class="nav-link">浏览器原理</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/0434c5/" class="nav-link">浏览器缓存其实就这么一回事儿</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/c048e3/" class="nav-link">浏览器兼容性问题</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/a7caa6/" class="nav-link">移动端开发兼容性适配</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/a986cc/" class="nav-link">前端性能优化</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/c1a6d9/" class="nav-link">前端如何进行seo优化</a></li><li class="dropdown-item"><h4>webpack</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/f8772a/" class="nav-link">webpack HMR</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/14a436/" class="nav-link">webpack优化基本方法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法集合" class="dropdown-title"><a href="/Front-end-notes/algorithm/" class="link-title">算法集合</a> <span class="title" style="display:none;">算法集合</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>leetcode题解</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/0b0af3/" class="nav-link">两数之和</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/acf1c6/" class="nav-link">判断整数是否为回文串</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/5695b7/" class="nav-link">无重复字符的最长子串</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/c29ced/" class="nav-link">Js链表</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/ffcbad/" class="nav-link">JavaScript排序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/Front-end-notes/framework/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>React</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/8df2fb/" class="nav-link">虚拟DOM原理理解</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/e61fb3/" class="nav-link">React Hook</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/b5eeec/" class="nav-link">组件复用指南</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/c390d1/" class="nav-link">Vue举一反三</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/Front-end-notes/interview/" class="nav-link">面试题</a></div><div class="nav-item"><a href="/Front-end-notes/books/" class="nav-link">读书笔记</a></div> <a href="https://github.com/syun0216/Front-end-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://avatars.githubusercontent.com/u/18444325?s=460&amp;u=6548250d9e4ad26571995008d5e74401d4b2243b&amp;v=4"> <div class="blogger-info"><h3>Syun0216</h3> <span>多读书多种树</span></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><a href="/Front-end-notes/JavaScript/" class="link-title">JavaScript</a> <span class="title" style="display:none;">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ES6</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/d9ebac/" class="nav-link">ES6 Decorator</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/780ea1/" class="nav-link">ES6核心特性</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/c8677a/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Promise&amp;Generator</a></li></ul></li><li class="dropdown-item"><h4>js原理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/1b56f1/" class="nav-link">简单实现bind、apply和call</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/abdbcb/" class="nav-link">如何遍历一个dom tree</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/a8d5a8/" class="nav-link">实现函数currying</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/2c3bf4/" class="nav-link">实现一个event</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/4eb0e3/" class="nav-link">详解js的继承</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/64db0d/" class="nav-link">详解requestAnimationFrame</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/12cc8e/" class="nav-link">Canvas api详解</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/185d72/" class="nav-link">DOM事件</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/c49367/" class="nav-link">EventLoop详解</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/b50bad/" class="nav-link">JavaScript的内存管理</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/38b7e6/" class="nav-link">JavaScript的运行机制</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/f16f62/" class="nav-link">Math对象</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/6cd659/" class="nav-link">new操作符都做了什么</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/46dbec/" class="nav-link">create基本实现原理</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/d980a4/" class="nav-link">Set、Map、WeakSet和WeakMap</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/674ecf/" class="nav-link">web worker原理</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/aa8fa2/" class="nav-link">WebGL教程(MDN)</a></li></ul></li><li class="dropdown-item"><h4>jsInfoSeries</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/7607c2/" class="nav-link">简介</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/422096/" class="nav-link">JavaScript基础知识</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/492e58/" class="nav-link">基础知识2</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/30968d/" class="nav-link">基础知识3</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/e139a1/" class="nav-link">基础知识4</a></li></ul></li><li class="dropdown-item"><h4>技巧</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/d7ece9/" class="nav-link"> 5个js解构有趣用途</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/c41df5/" class="nav-link">如何使用set提高代码性能</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/a66f47/" class="nav-link">cordova构建项目时的问题</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/662607/" class="nav-link">js中轻松遍历对象属性的几种方式</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><a href="/Front-end-notes/css/" class="link-title">CSS</a> <span class="title" style="display:none;">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/493b2e/" class="nav-link">怎么写出更好的css</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/f0604f/" class="nav-link">BFC详解</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/13ad2e/" class="nav-link">box-shadow详解</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/a07dbe/" class="nav-link">CSS小技巧</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/b81321/" class="nav-link">Grid布局详解</a></li></ul></div></div><div class="nav-item"><a href="/Front-end-notes/html/" class="nav-link">HTML</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><a href="/Front-end-notes/web/" class="link-title">网络</a> <span class="title" style="display:none;">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/6f3543/" class="nav-link">IP十问</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/34aa02/" class="nav-link">http笔试</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/13759c/" class="nav-link">http协议</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目构建" class="dropdown-title"><a href="/Front-end-notes/project/" class="link-title">项目构建</a> <span class="title" style="display:none;">项目构建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/8f406e/" class="nav-link">浏览器原理</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/0434c5/" class="nav-link">浏览器缓存其实就这么一回事儿</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/c048e3/" class="nav-link">浏览器兼容性问题</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/a7caa6/" class="nav-link">移动端开发兼容性适配</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/a986cc/" class="nav-link">前端性能优化</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/c1a6d9/" class="nav-link">前端如何进行seo优化</a></li><li class="dropdown-item"><h4>webpack</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/f8772a/" class="nav-link">webpack HMR</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/14a436/" class="nav-link">webpack优化基本方法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法集合" class="dropdown-title"><a href="/Front-end-notes/algorithm/" class="link-title">算法集合</a> <span class="title" style="display:none;">算法集合</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>leetcode题解</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/0b0af3/" class="nav-link">两数之和</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/acf1c6/" class="nav-link">判断整数是否为回文串</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/5695b7/" class="nav-link">无重复字符的最长子串</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/c29ced/" class="nav-link">Js链表</a></li><li class="dropdown-item"><!----> <a href="/Front-end-notes/pages/ffcbad/" class="nav-link">JavaScript排序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/Front-end-notes/framework/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>React</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/8df2fb/" class="nav-link">虚拟DOM原理理解</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/e61fb3/" class="nav-link">React Hook</a></li><li class="dropdown-subitem"><a href="/Front-end-notes/pages/b5eeec/" class="nav-link">组件复用指南</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Front-end-notes/pages/c390d1/" class="nav-link">Vue举一反三</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/Front-end-notes/interview/" class="nav-link">面试题</a></div><div class="nav-item"><a href="/Front-end-notes/books/" class="nav-link">读书笔记</a></div> <a href="https://github.com/syun0216/Front-end-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ES6</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-notes/pages/d9ebac/" class="sidebar-link">ES6 Decorator</a></li><li><a href="/Front-end-notes/pages/780ea1/" class="sidebar-link">ES6核心特性</a></li><li><a href="/Front-end-notes/pages/c8677a/" aria-current="page" class="active sidebar-link">Promise&amp;Generator</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-notes/pages/1b56f1/" class="sidebar-link">简单实现bind、apply和call</a></li><li><a href="/Front-end-notes/pages/abdbcb/" class="sidebar-link">如何遍历一个dom tree</a></li><li><a href="/Front-end-notes/pages/a8d5a8/" class="sidebar-link">实现函数currying</a></li><li><a href="/Front-end-notes/pages/2c3bf4/" class="sidebar-link">实现一个event</a></li><li><a href="/Front-end-notes/pages/4eb0e3/" class="sidebar-link">详解js的继承</a></li><li><a href="/Front-end-notes/pages/64db0d/" class="sidebar-link">详解requestAnimationFrame</a></li><li><a href="/Front-end-notes/pages/12cc8e/" class="sidebar-link">Canvas api详解</a></li><li><a href="/Front-end-notes/pages/185d72/" class="sidebar-link">DOM事件</a></li><li><a href="/Front-end-notes/pages/c49367/" class="sidebar-link">EventLoop详解</a></li><li><a href="/Front-end-notes/pages/b50bad/" class="sidebar-link">JavaScript的内存管理</a></li><li><a href="/Front-end-notes/pages/38b7e6/" class="sidebar-link">JavaScript的运行机制</a></li><li><a href="/Front-end-notes/pages/f16f62/" class="sidebar-link">Math对象</a></li><li><a href="/Front-end-notes/pages/6cd659/" class="sidebar-link">new操作符都做了什么</a></li><li><a href="/Front-end-notes/pages/46dbec/" class="sidebar-link">Object.create基本实现原理</a></li><li><a href="/Front-end-notes/pages/d980a4/" class="sidebar-link">Set、Map、WeakSet和WeakMap</a></li><li><a href="/Front-end-notes/pages/674ecf/" class="sidebar-link">web worker原理</a></li><li><a href="/Front-end-notes/pages/aa8fa2/" class="sidebar-link">WebGL教程(MDN)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>jsInfoSeries</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-notes/pages/7607c2/" class="sidebar-link">简介</a></li><li><a href="/Front-end-notes/pages/422096/" class="sidebar-link">JavaScript基础知识</a></li><li><a href="/Front-end-notes/pages/492e58/" class="sidebar-link">基础知识2</a></li><li><a href="/Front-end-notes/pages/30968d/" class="sidebar-link">基础知识3</a></li><li><a href="/Front-end-notes/pages/e139a1/" class="sidebar-link">基础知识4</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-notes/pages/d7ece9/" class="sidebar-link">5个js解构有趣用途</a></li><li><a href="/Front-end-notes/pages/c41df5/" class="sidebar-link">如何使用set提高代码性能</a></li><li><a href="/Front-end-notes/pages/a66f47/" class="sidebar-link">cordova构建项目时的问题</a></li><li><a href="/Front-end-notes/pages/662607/" class="sidebar-link">js中轻松遍历对象属性的几种方式</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-33863c7e><div class="articleInfo" data-v-33863c7e><ul class="breadcrumbs" data-v-33863c7e><li data-v-33863c7e><a href="/Front-end-notes/" title="首页" class="iconfont icon-home router-link-active" data-v-33863c7e></a></li> <li data-v-33863c7e><a href="/Front-end-notes/categories/?category=JavaScript" title="分类" data-v-33863c7e>JavaScript</a></li> <!----> <!----></ul> <div class="info" data-v-33863c7e><div title="作者" class="author iconfont icon-touxiang" data-v-33863c7e><a href="https://github.com/syun0216" target="_blank" title="作者" class="beLink" data-v-33863c7e>junwen</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>2019-08-06</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          Promise&amp;Generator
        </h1> <!----> <div class="theme-vdoing-content content__default"><p>Promise &amp; Generator 简单入门</p> <blockquote><p>参考<a href="https://segmentfault.com/a/1190000007255138" target="_blank" rel="noopener noreferrer">Promise &amp; Generator——幸福地用同步方法写异步 JavaScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>Promise 的特性：</p> <ol><li>关于 promise，首先要意识到它是一种对象。这种对象可以用 Promise 构造函数来创建，也可以通过 Nodejs 本身一些默认的返回来获取这种对象。</li> <li>promise 对象有三种状态：Pending，Fulfilled，Rejected。分别对应着未开始的状态，成功的状态，以及失败的状态。</li> <li>这种对象常常封装着异步的方法。在异步方法里面，通过 resolve 和 reject 来划定什么时候算是成功，什么时候算是错误，同时传参数给这两个函数。这些参数就是异步得到的结果或者错误。</li> <li>异步有成功的时候，也有错误的时候。对象通过 then 和 catch 方法来规定异步结束之后的操作（正确处理函数/错误处理函数）。而 then 和 catch 是 Promise.prototype 上的函数，因此“实例化”之后（其实并非真正的实例）可以直接使用。</li> <li>这个 promise 对象还有一个神奇的地方，就是可以级联。每一个 then 里面返回一个 promise 对象，就又像上面所提的那样，有异步就等待异步，然后选择出规定好的正确处理函数还是错误处理函数。</li></ol> <h3 id="构建-promise"><a href="#构建-promise" class="header-anchor">#</a> 构建 Promise</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">PromiseCustom</span><span class="token punctuation">(</span><span class="token parameter">Fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token function-variable function">resolveCall</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'default call'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFullFill</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 接受onFullFill方法</span>
    resolveCall <span class="token operator">=</span> onFullFill
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolveCall</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">Fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">PromiseCustom</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>在 new Promise 的时候会立即执行 fn,遇到异步方法，于是先执行 then 中的方法，将 onFullFill 存储到 resolveCall 中。异步时间到了以后，执行 resolve，从而执行 resolveCall 存储的 then 方法。</p> <blockquote><p>这里会有一个问题，就是 Promise 接受的方法不是异步，就会使 resolve 比 then 方法先执行。而此时 resolveCall 并没有被赋值，得不到我们想要的结果，所以要给 resolve 加上异步操作，从而保证 then 先执行</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolveCall</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="增加链式调用"><a href="#增加链式调用" class="header-anchor">#</a> 增加链式调用</h3> <p>在每个 then 方法中 return 一个 this</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">Fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>resolves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 方便存储onFullfilled</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token parameter">onFullfilled</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFullfilled<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 箭头函数，不用担心this指针问题</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">Fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>可以看到，这里将接收 then 回调的方法改为了 Promise 的属性 resolves，而且是数组。这是因为如果有多个 then，依次 push 到数组的方式才能存储，否则后面的 then 会将之前保存的覆盖掉。这样等到 resolve 被调用的时候，依次执行 resolves 中的函数就可以了。这样可以进行简单的链式调用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>但我们会有这样的需求，某一个 then 链想自己 return 一个参数供后面的 then 使用：</p> <p>eg:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
  <span class="token keyword">return</span> r
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>要做到这一步，需要再加一个处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 每次执行then的回调时判断一下是否有返回值，有的话更新value</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="增加状态"><a href="#增加状态" class="header-anchor">#</a> 增加状态</h3> <p>增加 pending,fullfilled 和 rejected 状态</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">Fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>resolves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'PENDING'</span> <span class="token comment">// 初始为'PENDING'状态</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>value
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token parameter">onFulfilled</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'PENDING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果是'PENDING'，则储存到数组中</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'FULFILLED'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果是'FULFILLED'，则立即执行回调</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'isFULFILLED'</span><span class="token punctuation">)</span>
      <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'PENDING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 'PENDING' 状态才执行resolve操作</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//状态转换为FULFILLED</span>
        <span class="token comment">//执行then时保存到resolves里的回调</span>
        <span class="token comment">//如果回调有返回值，更新当前value</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'FULFILLED'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">Fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>这里可能会有同学觉得困惑，我们通过一个例子来说明增加的这些处理到底有什么用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> getInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hahah'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  getInfor<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// success</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在 resolve 函数中，判断了'PENDING' 状态才执行 setTimeout 方法，并且在执行时更改了状态为'FULFILLED'。这时，如果运行这个例子，只会输出一个‘success’，因为接下来的异步方法调用时状态已经被改为‘FULFILLED’，所以不会再次执行。</p> <p>这种情况要想它可以执行，就需要用到 then 方法里的判断，如果状态是'FULFILLED'，则立即执行回调。此时的传参是在 resolve 执行时保存的 this.value。这样就符合 Promise 的状态原则，PENDING 不可逆，FULFILLED 和 REJECTED 不能相互转化。 * 增加失败处理</p> <p>onRejected:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>reason
<span class="token keyword">this</span><span class="token punctuation">.</span>rejects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">// 接收失败的onRejected函数</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'PENDING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如果状态是'REJECTED'，则立即执行onRejected。</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'REJECTED'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// reject方法</span>

<span class="token keyword">let</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'PENDING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//状态转换为REJECTED</span>
      <span class="token comment">//执行then时保存到rejects里的回调</span>
      <span class="token comment">//如果回调有返回值，更新当前reason</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'REJECTED'</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>reason <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token operator">||</span> reason<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行Fn出错直接reject</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">Fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>在执行储存 then 中的回调函数那一步有一个细节一直没有处理，那就是判断是否有 onFulfilled 或者 onRejected 方法，因为是允许不要其中一个的。现在如果 then 中缺少某个回调，会直接 push 进 undefined，如果执行的话就会出错，所以要先判断一下是否是函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断是否是函数，是函数则执行</span>

  <span class="token keyword">function</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> value
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">erro</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> reason
  <span class="token punctuation">}</span>

  <span class="token comment">// 下面的处理也要换成新定义的函数</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'PENDING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>erro<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'FULFILLED'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'REJECTED'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">erro</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>因为 reject 回调执行时和 resolve 基本一样，所以稍微优化一下部分代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'PENDING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token function-variable function">transition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">status<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> status
      <span class="token keyword">let</span> f <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'FULFILLED'</span><span class="token punctuation">,</span>
        queue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>f <span class="token operator">?</span> <span class="token string">'resolves'</span> <span class="token operator">:</span> <span class="token string">'rejects'</span><span class="token punctuation">]</span>
      queue<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>val <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">||</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">[</span>f <span class="token operator">?</span> <span class="token string">'value'</span> <span class="token operator">:</span> <span class="token string">'reason'</span><span class="token punctuation">]</span> <span class="token operator">=</span> val
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">'FULFILLED'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">'REJECTED'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="串行-promise"><a href="#串行-promise" class="header-anchor">#</a> 串行 Promise</h3> <p>假设有多个 ajax 请求串联调用，下一个需要上一个的返回值作为参数，并且要 return 一个新的 Promise 捕捉错误。之前的例子可以执行是因为没有在 then 中做异常处理，即没有 reject，只是传递了数据。我们需要每个 then 方法中 return 一个新的 Promise。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 把then方法放到原型上，这样new一个新的Promise时就回去引用prototype的then方法，而不是复制一份</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span>
        <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> value
      <span class="token function">resolve</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token comment">// 执行完这个then方法的onFulfilled以后，resolve下一个then方法</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">erro</span><span class="token punctuation">(</span><span class="token parameter">reson</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> rea <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>reson<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> reson
      <span class="token function">reject</span><span class="token punctuation">(</span>rea<span class="token punctuation">)</span> <span class="token comment">// 同resolve</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'PENDING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      promise<span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span>
      promise<span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>erro<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>promise<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'FULFILLED'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">success</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>promise<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'REJECTED'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">erro</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>在成功的函数中还需要做一个处理，用以支持在 then 的回调函数（onFulfilled）中 return 的 Promise。如果 onFulfilled 方法 return 的是一个 Promise，则直接执行它的 then 方法。如果成功了，就继续执行后面的 then 链，失败了直接调用 reject。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> val <span class="token operator">=</span> tyoeof onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> value<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> val<span class="token punctuation">[</span><span class="token string">'then'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 判断是否有then方法</span>
    val<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果返回的是Promise 则直接执行得到结果后在调用后面的then方法</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reson</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>reson<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>找个例子测试一下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> fail</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> ran <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> ran<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ran <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>fail<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token string">'Vchat'</span><span class="token punctuation">,</span> <span class="token string">'fail'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token string">'可以线上预览了'</span><span class="token punctuation">,</span> <span class="token string">'erro'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">rej</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rej<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">rej</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rej<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token comment">// 输出</span>
<span class="token comment">// Vchat 0.8914818954810422</span>
<span class="token comment">// Vchat</span>
<span class="token comment">// 可以线上预览了 0.03702367800412443</span>
<span class="token comment">// erro</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>Generator 的特性：</p> <ol><li>函数的内部通过 yield 来推进函数。通过定义 yield 后面的值来决定返回的 value。</li> <li>数返回一个遍历器，这个遍历器有一个 next 方法，可以获取一个对象，这个对象就包含了 yield 定义好的参数。</li></ol> <h3 id="如何用同步的写法写异步的代码"><a href="#如何用同步的写法写异步的代码" class="header-anchor">#</a> 如何用同步的写法写异步的代码</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> name<span class="token punctuation">,</span> newPassword<span class="token punctuation">,</span> oldPassword</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// yield一个promise对象，如果有错误就会被后面的catch捕捉到，成功就会返回user。</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 常见的数据库读取星系</span>
      User<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>password <span class="token operator">!=</span> oldPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> errorMsg<span class="token operator">:</span> <span class="token string">'密码输入错误！'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 看到这一个异步函数和上一个的异步在写法上是基本上“同步”的，没有了相互嵌套，很优雅~也更加方便了debug~</span>
    <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      User<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> newPassword<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> msg<span class="token operator">:</span> <span class="token string">'你成功更换密码了！'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> errorMsg<span class="token operator">:</span> <span class="token string">'Setting Fail!'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用的话就直接调用co包含对应的Generator函数即可。</span>
<span class="token function">co</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> name<span class="token punctuation">,</span> newPassword<span class="token punctuation">,</span> oldPassword<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>关于<a href="https://github.com/tj/co" target="_blank" rel="noopener noreferrer">co<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/syun0216/Front-end-notes/edit/master/docs/JavaScript/ES6/Promise&amp;Generator.md" target="_blank" rel="noopener noreferrer">在Github上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/Front-end-notes/tags/?tag=ES6" title="标签">#ES6</a><a href="/Front-end-notes/tags/?tag=JavaScript" title="标签">#JavaScript</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/22/2021, 3:47:15 AM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/Front-end-notes/pages/780ea1/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ES6核心特性</div></a> <a href="/Front-end-notes/pages/1b56f1/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">简单实现bind、apply和call</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Front-end-notes/pages/780ea1/" class="prev">ES6核心特性</a></span> <span class="next"><a href="/Front-end-notes/pages/1b56f1/">简单实现bind、apply和call</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/Front-end-notes/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/Front-end-notes/pages/ad11bf/"><div>如何打造全链路项目生命周期的统一交付平台</div></a> <span>04-10</span></dt></dl><dl><dd>02</dd> <dt><a href="/Front-end-notes/pages/91ed70/"><div>如何建立前端标准化研发流程</div></a> <span>04-10</span></dt></dl><dl><dd>03</dd> <dt><a href="/Front-end-notes/pages/3b57cc/"><div>如何从0到1一步步成体系地搭建CI</div></a> <span>04-10</span></dt></dl> <dl><dd></dd> <dt><a href="/Front-end-notes/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:517897442@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/syun0216" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2021
    <span>Syun</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/Front-end-notes/assets/js/app.adb127c3.js" defer></script><script src="/Front-end-notes/assets/js/2.d7e66a74.js" defer></script><script src="/Front-end-notes/assets/js/35.69d0c608.js" defer></script>
  </body>
</html>